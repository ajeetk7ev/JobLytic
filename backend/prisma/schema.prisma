generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  fullName     String
  email        String   @unique
  password     String
  avatar       String?  // Cloudinary URL
  resetPasswordToken String?
  resetPasswordExpire DateTime?
  refreshToken String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  resumes      Resume[]
  jobApplications JobApplication[]
  
  // Subscription fields
  credits      Int      @default(5)
  plan         String   @default("free") // "free", "pro_monthly", "pro_yearly"
  subscriptionExpiresAt DateTime?
  payments     Payment[]
}

model Payment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  userId        String   @db.ObjectId
  user          User     @relation(fields: [userId], references: [id])
  razorpayOrderId String
  razorpayPaymentId String?
  amount        Int
  currency      String
  status        String   // "pending", "completed", "failed"
  createdAt     DateTime @default(now())
}

model Resume {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  rawText   String?
  data      Json
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Job {
  id                     String   @id @default(auto()) @map("_id") @db.ObjectId
  jobId                  String   @unique              // job_id from API
  jobTitle               String?
  employerName           String?
  employerLogo           String?
  employerWebsite        String?
  jobPublisher           String?
  jobEmploymentType      String?
  jobEmploymentTypes     String[] @default([])
  jobApplyLink           String?
  applyOptions           Json?
  jobDescription         String?
  jobIsRemote            Boolean?
  jobPostedAt            String?
  jobPostedAtTimestamp   Int?
  jobPostedAtUTC         DateTime?

  jobLocation            String?
  jobCity                String?
  jobState               String?
  jobCountry             String?
  jobLatitude            Float?
  jobLongitude           Float?

  jobBenefits            String[] @default([])
  jobGoogleLink          String?
  jobMinSalary           Int?
  jobMaxSalary           Int?
  jobSalaryPeriod        String?
  jobHighlights          Json?

  jobOnetSoc             String?
  jobOnetJobZone         String?

  createdAt              DateTime @default(now())
  expiresAt              DateTime // (createdAt + 24 hours)
}


model JobQuery {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  query     String   @unique
  fetchedAt DateTime @default(now())
}

model JobApplication {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  user        User     @relation(fields: [userId], references: [id])
  
  jobId       String?  @db.ObjectId // Optional link to a Job in our DB
  
  company     String
  position    String
  location    String?
  type        String?  // Remote, Hybrid, On-site
  
  status      String   @default("applied") // wishlist, applied, interviewing, offer, rejected
  
  salary      String?
  url         String?
  
  dateApplied DateTime?
  
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}
